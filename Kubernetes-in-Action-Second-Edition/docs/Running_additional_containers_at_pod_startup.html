
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>5.5 Running additional containers at pod startup · Kubernetes实战（第二版）</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="wangwei17">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Deleting_pods_and_other_objects.html" />
    
    
    <link rel="prev" href="Running_multiple_containers_in_a_pod.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://wangwei1237.gitee.io/" target="_blank" class="custom-link">17哥的个人网站</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Welcome</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="Welcome.html">
            
                <a href="Welcome.html">
            
                    
                    Welcome
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 1: First Time On a Boat: Introduction to Kubernetes</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="Introducing_Kubernetes_0.html">
            
                <a href="Introducing_Kubernetes_0.html">
            
                    
                    1 Introducing Kubernetes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="Introducing_Kubernetes_1.html">
            
                <a href="Introducing_Kubernetes_1.html">
            
                    
                    1.1 Introducing Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="Understanding_Kubernetes.html">
            
                <a href="Understanding_Kubernetes.html">
            
                    
                    1.2 Understanding Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="Introducing_Kubernetes_into_your_organization.html">
            
                <a href="Introducing_Kubernetes_into_your_organization.html">
            
                    
                    1.3 Introducing Kubernetes into your organization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="Summary_1.html">
            
                <a href="Summary_1.html">
            
                    
                    1.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Understanding_containers.html">
            
                <a href="Understanding_containers.html">
            
                    
                    2 Understanding containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="Introducing_containers.html">
            
                <a href="Introducing_containers.html">
            
                    
                    2.1 Introducing containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="Exploring_containers_hands-on.html">
            
                <a href="Exploring_containers_hands-on.html">
            
                    
                    2.2 Exploring containers hands-on
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="Understanding_what_makes_containers_possible.html">
            
                <a href="Understanding_what_makes_containers_possible.html">
            
                    
                    2.3 Understanding what makes containers possible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="Summary_2.html">
            
                <a href="Summary_2.html">
            
                    
                    2.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Deploying_your_first_application.html">
            
                <a href="Deploying_your_first_application.html">
            
                    
                    3 DEPLOYING YOUR FIRST APPLICATION
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="Deploying_a_Kubernetes_cluster.html">
            
                <a href="Deploying_a_Kubernetes_cluster.html">
            
                    
                    3.1 Deploying a Kubernetes cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="Interacting_with_Kubernetes.html">
            
                <a href="Interacting_with_Kubernetes.html">
            
                    
                    3.2 Interacting with Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="Running_your_first_application_on_Kubernetes.html">
            
                <a href="Running_your_first_application_on_Kubernetes.html">
            
                    
                    3.3  Running your first application on Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="Summary_3.html">
            
                <a href="Summary_3.html">
            
                    
                    3.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Part 2: Learning the Ropes: Kubernetes API Objects</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="Introducing_the_Kubernetes_API_Objects.html">
            
                <a href="Introducing_the_Kubernetes_API_Objects.html">
            
                    
                    4. Introducing the Kubernetes API Objects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="Getting_familiar_with_the_Kubernetes_API.html">
            
                <a href="Getting_familiar_with_the_Kubernetes_API.html">
            
                    
                    4.1 Getting familiar with the Kubernetes API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="Examining_an_objects_individual_properties.html">
            
                <a href="Examining_an_objects_individual_properties.html">
            
                    
                    4.2 Examining an object’s individual properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="Observing_cluster_events_via_Event_objects.html">
            
                <a href="Observing_cluster_events_via_Event_objects.html">
            
                    
                    4.3 Observing cluster events via Event objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="Summary_4.html">
            
                <a href="Summary_4.html">
            
                    
                    4.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="Running_applications_in_Pods.html">
            
                <a href="Running_applications_in_Pods.html">
            
                    
                    5. Running applications in Pods
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="Understanding_pods.html">
            
                <a href="Understanding_pods.html">
            
                    
                    5.1  Understanding pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="Creating_pods_from_YAML_or_JSON_files.html">
            
                <a href="Creating_pods_from_YAML_or_JSON_files.html">
            
                    
                    5.2 Creating pods from YAML or JSON files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="Interacting_with_the_application_and_the_pod.html">
            
                <a href="Interacting_with_the_application_and_the_pod.html">
            
                    
                    5.3 Interacting with the application and the pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="Running_multiple_containers_in_a_pod.html">
            
                <a href="Running_multiple_containers_in_a_pod.html">
            
                    
                    5.4 Running multiple containers in a pod
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.2.5" data-path="Running_additional_containers_at_pod_startup.html">
            
                <a href="Running_additional_containers_at_pod_startup.html">
            
                    
                    5.5 Running additional containers at pod startup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.6" data-path="Deleting_pods_and_other_objects.html">
            
                <a href="Deleting_pods_and_other_objects.html">
            
                    
                    5.6 Deleting pods and other objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.7" data-path="Summary_5.html">
            
                <a href="Summary_5.html">
            
                    
                    5.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Managing_the_lifecycle_of_the_Pods_containers.html">
            
                <a href="Managing_the_lifecycle_of_the_Pods_containers.html">
            
                    
                    6. Managing the lifecycle of the Pod’s containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="Understanding_the_pods_status.html">
            
                <a href="Understanding_the_pods_status.html">
            
                    
                    6.1 Understanding the pod's status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="Keeping_containers_healthy.html">
            
                <a href="Keeping_containers_healthy.html">
            
                    
                    6.2 Keeping containers healthy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="Executing_actions_at_container_startup_and_shutdown.html">
            
                <a href="Executing_actions_at_container_startup_and_shutdown.html">
            
                    
                    6.3 Executing actions at container start-up and shutdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="Understanding_the_pod_lifecycle.html">
            
                <a href="Understanding_the_pod_lifecycle.html">
            
                    
                    6.4 Understanding the pod lifecycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="Summary_6.html">
            
                <a href="Summary_6.html">
            
                    
                    6.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="Mounting_storage_volumes_into_the_Pods_containers.html">
            
                <a href="Mounting_storage_volumes_into_the_Pods_containers.html">
            
                    
                    7. Mounting storage volumes into the Pod’s containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="Introducing_volumes.html">
            
                <a href="Introducing_volumes.html">
            
                    
                    7.1 Introducing volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.2" data-path="Using_volumes.html">
            
                <a href="Using_volumes.html">
            
                    
                    7.2 Using volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="Integrating_external_storage_into_pods.html">
            
                <a href="Integrating_external_storage_into_pods.html">
            
                    
                    7.3 Integrating external storage into pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.4" data-path="Accessing_files_on_the_worker_nodes_filesystem.html">
            
                <a href="Accessing_files_on_the_worker_nodes_filesystem.html">
            
                    
                    7.4 Accessing files on the worker node’s filesystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.5" data-path="Summary_7.html">
            
                <a href="Summary_7.html">
            
                    
                    7.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Persisting_application_data_with_PersistentVolumes.html">
            
                <a href="Persisting_application_data_with_PersistentVolumes.html">
            
                    
                    8. Persisting application data with PersistentVolumes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="Decoupling_pods_from_the_underlying_storage_technology.html">
            
                <a href="Decoupling_pods_from_the_underlying_storage_technology.html">
            
                    
                    8.1 Decoupling pods from the underlying storage technology
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.2" data-path="Creating_persistent_volumes_and_claims.html">
            
                <a href="Creating_persistent_volumes_and_claims.html">
            
                    
                    8.2 Creating persistent volumes and claims
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.3" data-path="Dynamic_provisioning_of_persistent_volumes.html">
            
                <a href="Dynamic_provisioning_of_persistent_volumes.html">
            
                    
                    8.3 Dynamic provisioning of persistent volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.4" data-path="Nodelocal_persistent_volumes.html">
            
                <a href="Nodelocal_persistent_volumes.html">
            
                    
                    8.4 Node-local persistent volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.5" data-path="Summary_8.html">
            
                <a href="Summary_8.html">
            
                    
                    8.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="Configuring_applications_using_ConfigMaps_Secrets_and_the_Downward_API.html">
            
                <a href="Configuring_applications_using_ConfigMaps_Secrets_and_the_Downward_API.html">
            
                    
                    9. Configuring applications using ConfigMaps, Secrets, and the Downward API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="Setting_the_command_arguments_and_environment_variables.html">
            
                <a href="Setting_the_command_arguments_and_environment_variables.html">
            
                    
                    9.1 Setting the command, arguments, and environment variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.2" data-path="Using_a_config_map_to_decouple_configuration_from_the_pod.html">
            
                <a href="Using_a_config_map_to_decouple_configuration_from_the_pod.html">
            
                    
                    9.2 Using a config map to decouple configuration from the pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.3" data-path="Using_Secrets_to_pass_sensitive_data_to_containers.html">
            
                <a href="Using_Secrets_to_pass_sensitive_data_to_containers.html">
            
                    
                    9.3 Using Secrets to pass sensitive data to containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.4" data-path="Passing_pod_metadata_to_the_application_via_the_Downward_API.html">
            
                <a href="Passing_pod_metadata_to_the_application_via_the_Downward_API.html">
            
                    
                    9.4 Passing pod metadata to the application via the Downward API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.5" data-path="Using_projected_volumes_to_combine_volumes_into_one.html">
            
                <a href="Using_projected_volumes_to_combine_volumes_into_one.html">
            
                    
                    9.5 Using projected volumes to combine volumes into one
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.6" data-path="Summary_9.html">
            
                <a href="Summary_9.html">
            
                    
                    9.6 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="Organizing_objects_using_Namespaces_labels.html">
            
                <a href="Organizing_objects_using_Namespaces_labels.html">
            
                    
                    10. Organizing objects using Namespaces, labels, and selectors
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.1" data-path="Organizing_objects_into_Namespaces.html">
            
                <a href="Organizing_objects_into_Namespaces.html">
            
                    
                    10.1 Organizing objects into Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.2" data-path="Organizing_pods_with_labels.html">
            
                <a href="Organizing_pods_with_labels.html">
            
                    
                    10.2 Organizing pods with labels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.3" data-path="Filtering_Objects_With_Label_Selectors.html">
            
                <a href="Filtering_Objects_With_Label_Selectors.html">
            
                    
                    10.3 Filtering objects with label selectors.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.4" data-path="Annotating_objects.html">
            
                <a href="Annotating_objects.html">
            
                    
                    10.4 Annotating objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.5" data-path="Summary_10.html">
            
                <a href="Summary_10.html">
            
                    
                    10.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="Exposing_Pods_with_Services.html">
            
                <a href="Exposing_Pods_with_Services.html">
            
                    
                    11. Exposing Pods with Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.1" data-path="Exposing_pods_via_services.html">
            
                <a href="Exposing_pods_via_services.html">
            
                    
                    11.1 Exposing pods via services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.2" data-path="Exposing_services_externally.html">
            
                <a href="Exposing_services_externally.html">
            
                    
                    11.2 Exposing services externally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.3" data-path="Managing_service_endpoints.html">
            
                <a href="Managing_service_endpoints.html">
            
                    
                    11.3 Managing service endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.4" data-path="Understanding_DNS_records_for_Service_objects.html">
            
                <a href="Understanding_DNS_records_for_Service_objects.html">
            
                    
                    11.4 Understanding DNS records for Service objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.5" data-path="Configuring_services_to_route_traffic_to_nearby_endpoints.html">
            
                <a href="Configuring_services_to_route_traffic_to_nearby_endpoints.html">
            
                    
                    11.5 Configuring services to route traffic to nearby endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.6" data-path="Managing_the_inclusion_of_a_pod_in_service_endpoints.html">
            
                <a href="Managing_the_inclusion_of_a_pod_in_service_endpoints.html">
            
                    
                    11.6 Managing the inclusion of a pod in service endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.7" data-path="Summary_11.html">
            
                <a href="Summary_11.html">
            
                    
                    11.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="Exposing_Services_with_Ingress.html">
            
                <a href="Exposing_Services_with_Ingress.html">
            
                    
                    12. Exposing Services with Ingress
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.9.1" data-path="Introducing_Ingresses.html">
            
                <a href="Introducing_Ingresses.html">
            
                    
                    12.1 Introducing Ingresses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.2" data-path="Creating_and_using_Ingress_objects.html">
            
                <a href="Creating_and_using_Ingress_objects.html">
            
                    
                    12.2 Creating and using Ingress objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.3" data-path="Configuring_TLS_for_an_Ingress.html">
            
                <a href="Configuring_TLS_for_an_Ingress.html">
            
                    
                    12.3 Configuring TLS for an Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.4" data-path="Additional_Ingress_configuration_options.html">
            
                <a href="Additional_Ingress_configuration_options.html">
            
                    
                    12.4 Additional Ingress configuration options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.5" data-path="Using_multiple_ingress_controllers.html">
            
                <a href="Using_multiple_ingress_controllers.html">
            
                    
                    12.5 Using multiple ingress controllers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.6" data-path="Using_custom_resources_instead_of_services_as_backends.html">
            
                <a href="Using_custom_resources_instead_of_services_as_backends.html">
            
                    
                    12.6 Using custom resources instead of services as backends
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.7" data-path="Summary_12.html">
            
                <a href="Summary_12.html">
            
                    
                    12.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="Replicating_Pods_with_ReplicaSets.html">
            
                <a href="Replicating_Pods_with_ReplicaSets.html">
            
                    
                    13 Replicating Pods with ReplicaSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.10.1" data-path="Introducing_ReplicaSets.html">
            
                <a href="Introducing_ReplicaSets.html">
            
                    
                    13.1 Introducing ReplicaSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.2" data-path="Updating_a_ReplicaSet.html">
            
                <a href="Updating_a_ReplicaSet.html">
            
                    
                    13.2 Updating a ReplicaSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.3" data-path="Understanding_the_operation_of_the_ReplicaSet_controller.html">
            
                <a href="Understanding_the_operation_of_the_ReplicaSet_controller.html">
            
                    
                    13.3 Understanding the operation of the ReplicaSet controller
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.4" data-path="Deleting_a_ReplicaSet.html">
            
                <a href="Deleting_a_ReplicaSet.html">
            
                    
                    13.4 Deleting a ReplicaSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.5" data-path="Summary_13.html">
            
                <a href="Summary_13.html">
            
                    
                    13.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="Managing_Pods_with_Deployments.html">
            
                <a href="Managing_Pods_with_Deployments.html">
            
                    
                    14 Managing Pods with Deployments
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.11.1" data-path="Introducing_Deployments.html">
            
                <a href="Introducing_Deployments.html">
            
                    
                    14.1 Introducing Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.2" data-path="Updating_a_Deployment.html">
            
                <a href="Updating_a_Deployment.html">
            
                    
                    14.2 Updating a Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.3" data-path="Implementing_other_deployment_strategies.html">
            
                <a href="Implementing_other_deployment_strategies.html">
            
                    
                    14.3 Implementing other deployment strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.4" data-path="Summary_14.html">
            
                <a href="Summary_14.html">
            
                    
                    14.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="Deploying_stateful_workloads_with_StatefulSets.html">
            
                <a href="Deploying_stateful_workloads_with_StatefulSets.html">
            
                    
                    15 Deploying stateful workloads with StatefulSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.12.1" data-path="Introducing_StatefulSets.html">
            
                <a href="Introducing_StatefulSets.html">
            
                    
                    15.1 IntroducingStatefulSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.2" data-path="Understanding_StatefulSet_behavior.html">
            
                <a href="Understanding_StatefulSet_behavior.html">
            
                    
                    15.2 Understanding StatefulSet behavior
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.3" data-path="Updating_a_StatefulSet.html">
            
                <a href="Updating_a_StatefulSet.html">
            
                    
                    15.3 Updating a StatefulSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.4" data-path="Managing_stateful_applications_with_Kubernetes_Operators.html">
            
                <a href="Managing_stateful_applications_with_Kubernetes_Operators.html">
            
                    
                    15.4 Managing stateful applications with Kubernetes Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.5" data-path="Summary_15.html">
            
                <a href="Summary_15.html">
            
                    
                    15.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="Deploying_node_agents_and_daemons_with_DaemonSets.html">
            
                <a href="Deploying_node_agents_and_daemons_with_DaemonSets.html">
            
                    
                    16 Deploying node agents and daemons with DaemonSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.13.1" data-path="Introducing_DaemonSets.html">
            
                <a href="Introducing_DaemonSets.html">
            
                    
                    16.1 Introducing DaemonSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.2" data-path="Special_features_in_Pods_running_node_agents_and_daemons.html">
            
                <a href="Special_features_in_Pods_running_node_agents_and_daemons.html">
            
                    
                    16.2 Special features in Pods running node agents and daemons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.3" data-path="Communicating_with_the_local_daemon_Pod.html">
            
                <a href="Communicating_with_the_local_daemon_Pod.html">
            
                    
                    16.3  Communicating with the local daemon Pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.4" data-path="Summary_16.html">
            
                <a href="Summary_16.html">
            
                    
                    16.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.14" data-path="Running_finite_workloads_with_Jobs_and_CronJobss.html">
            
                <a href="Running_finite_workloads_with_Jobs_and_CronJobss.html">
            
                    
                    17 Running finite workloads with Jobs and CronJobs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.14.1" data-path="Running_tasks_with_the_Job_resource.html">
            
                <a href="Running_tasks_with_the_Job_resource.html">
            
                    
                    17.1 Running tasks with the Job resource
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.14.2" data-path="Scheduling_Jobs_with_CronJobs.html">
            
                <a href="Scheduling_Jobs_with_CronJobs.html">
            
                    
                    17.2 Scheduling Jobs with CronJobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.14.3" data-path="Summary_17.html">
            
                <a href="Summary_17.html">
            
                    
                    17.3 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >5.5 Running additional containers at pod startup</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="55-running-additional-containers-at-pod-startup">5.5 Running additional containers at pod startup</h1>
<p>When a pod contains more than one container, all the containers are started in parallel. Kubernetes doesn&#x2019;t yet provide a mechanism to specify whether a container depends on another container, which would allow you to ensure that one is started before the other. However, Kubernetes allows you to run a sequence of containers to initialize the pod before its main containers start. This special type of container is explained in this section.</p>
<h2 id="introducing-init-containers">Introducing init containers</h2>
<p>A pod manifest can specify a list of containers to run when the pod starts and before the pod&#x2019;s normal containers are started. These containers are intended to initialize the pod and are appropriately called init containers. As the following figure shows, they run one after the other and must all finish successfully before the main containers of the pod are started.</p>
<p>Figure 5.11 Time sequence showing how a pod&#x2019;s init and regular containers are started</p>
<p><img src="../images/5.11.png" alt=""></p>
<p>Init containers are like the pod&#x2019;s regular containers, but they don&#x2019;t run in parallel - only one init container runs at a time.</p>
<h3 id="understanding-what-init-containers-can-do">Understanding what init containers can do</h3>
<p>Init containers are typically added to pods to achieve the following:</p>
<ul>
<li>Initialize files in the volumes used by the pod&#x2019;s main containers. This includes retrieving certificates and private keys used by the main container from secure certificate stores, generating config files, downloading data, and so on.</li>
<li>Initialize the pod&#x2019;s networking system. Because all containers of the pod share the same network namespaces, and thus the network interfaces and configuration, any changes made to it by an init container also affect the main container.</li>
<li>Delay the start of the pod&#x2019;s main containers until a precondition is met. For example, if the main container relies on another service being available before the container is started, an init container can block until this service is ready.</li>
<li>Notify an external service that the pod is about to start running. In special cases where an external system must be notified when a new instance of the application is started, an init container can be used to deliver this notification.</li>
</ul>
<p>You could perform these operations in the main container itself but using an init container is sometimes a better option and can have other advantages. Let&#x2019;s see why.</p>
<h3 id="understanding-when-moving-initialization-code-to-init-containers-makes-sense">Understanding when moving initialization code to init containers makes sense</h3>
<p>Using an init container to perform initialization tasks doesn&#x2019;t require the main container image to be rebuilt and allows a single init container image to be reused with many different applications. This is especially useful if you want to inject the same infrastructure-specific initialization code into all your pods. Using an init container also ensures that this initialization is complete before any of the (possibly multiple) main containers start.</p>
<p>Another important reason is security. By moving tools or data that could be used by an attacker to compromise your cluster from the main container to an init container, you reduce the pod&#x2019;s attack surface.</p>
<p>For example, imagine that the pod must be registered with an external system. The pod needs some sort of secret token to authenticate against this system. If the registration procedure is performed by the main container, this secret token must be present in its filesystem. If the application running in the main container has a vulnerability that allows an attacker to read arbitrary files on the filesystem, the attacker may be able to obtain this token. By performing the registration from an init container, the token must be available only in the filesystem of the init container, which an attacker can&#x2019;t easily compromise.</p>
<h2 id="adding-init-containers-to-a-pod">Adding init containers to a pod</h2>
<p>In a pod manifest, init containers are defined in the <code>initContainers</code> field in the spec section, just as regular containers are defined in its <code>containers</code> field.</p>
<h3 id="adding-two-containers-to-the-kubia-ssl-pod">Adding two containers to the kubia-ssl pod</h3>
<p>Let&#x2019;s look at an example of adding two init containers to the kubia pod. The first init container emulates an initialization procedure. It runs for 5 seconds, while printing a few lines of text to standard output.</p>
<p>The second init container performs a network connectivity test by using the <code>ping</code> command to check if a specific IP address is reachable from within the pod. If the IP address is not specified, the address 1.1.1.1 is used. You&#x2019;ll find the <code>Dockerfiles</code> and other artifacts for both images in the book&#x2019;s code archive, if you want to build them yourself. Alternatively, you can use the pre-build images specified in the following listing.</p>
<p>A pod manifest containing these two init containers is in the <code>kubia-init.yaml</code> file. The following listing shows how the init containers are defined.</p>
<pre><code class="lang-YAML">Listing <span class="hljs-number">5.9</span> Defining init containers in a pod manifest: kubia-init.yaml
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Pod
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> kubia-init
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  initContainers:</span>
<span class="hljs-attr">  - name:</span> init-demo
<span class="hljs-attr">    image:</span> luksa/init-demo:<span class="hljs-number">1.0</span>
<span class="hljs-attr">  - name:</span> network-check
<span class="hljs-attr">    image:</span> luksa/network-connectivity-checker:<span class="hljs-number">1.0</span>
<span class="hljs-attr">  containers:</span>
<span class="hljs-attr">  - name:</span> kubia
<span class="hljs-attr">    image:</span> luksa/kubia:<span class="hljs-number">1.0</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> http
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">8080</span>
<span class="hljs-attr">  - name:</span> envoy
<span class="hljs-attr">    image:</span> luksa/kubia-ssl-proxy:<span class="hljs-number">1.0</span>
<span class="hljs-attr">    ports:</span>
<span class="hljs-attr">    - name:</span> https
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">8443</span>
<span class="hljs-attr">    - name:</span> admin
<span class="hljs-attr">      containerPort:</span> <span class="hljs-number">9901</span>
</code></pre>
<p>As you can see, the definition of an init container is almost trivial. It&#x2019;s sufficient to specify only the <code>name</code> and <code>image</code> for each container.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>Container names must be unique within the union of all init and regular containers.</p>
</div></div></p>
<h3 id="deploying-a-pod-with-init-containers">Deploying a pod with init containers</h3>
<p>Before you create the pod from the manifest file, run the following command in a separate terminal so you can see how the pod&#x2019;s status changes as the init and regular containers start:</p>
<pre><code class="lang-shell">$ kubectl get pods -w
</code></pre>
<p>You&#x2019;ll also want to watch events in another terminal using the following command:</p>
<pre><code class="lang-shell">$ kubectl get events -w
</code></pre>
<p>When ready, create the pod by running the apply command:</p>
<pre><code class="lang-shell">$ kubectl apply -f kubia-init.yaml
</code></pre>
<h3 id="inspecting-the-startup-of-a-pod-with-init-containers">Inspecting the startup of a pod with init containers</h3>
<p>As the pod starts up, inspect the events that the <code>kubectl get events -w</code> command prints. The following listing shows what you should see.</p>
<pre><code class="lang-shell">Listing 5.10 Pod events showing how the execution of init containers
TYPE     REASON      MESSAGE
Normal   Scheduled   Successfully assigned pod to worker2
Normal   Pulling     Pulling image &quot;luksa/init-demo:1.0&quot;
Normal   Pulled      Successfully pulled image
Normal   Created     Created container init-demo
Normal   Started     Started container init-demo
Normal   Pulling     Pulling image &quot;luksa/network-connec...
Normal   Pulled      Successfully pulled image
Normal   Created     Created container network-check
Normal   Started     Started container network-check
Normal   Pulled      Container image &quot;luksa/kubia:1.0&quot;
                     already present on machine
Normal   Created     Created container kubia
Normal   Started     Started container kubia
Normal   Pulled      Container image &quot;luksa/kubia-ssl-
                     proxy:1.0&quot; already present on machine
Normal   Created     Created container envoy
Normal   Started     Started container envoy
</code></pre>
<p>The listing shows the order in which the containers are started. The <code>init-demo</code> container is started first. When it completes, the <code>network-check</code> container is started, and when it completes, the two main containers, <code>kubia</code> and <code>envoy</code>, are started.</p>
<p>Now inspect the transitions of the pod&#x2019;s status in the other terminal. They are shown in the next listing.</p>
<pre><code class="lang-shell">Listing 5.11 Pod status changes during startup involving init containers
NAME         READY   STATUS            RESTARTS   AGE
kubia-init   0/2     Pending           0          0s
kubia-init   0/2     Pending           0          0s
kubia-init   0/2     Init:0/2          0          0s
kubia-init   0/2     Init:0/2          0          1s
kubia-init   0/2     Init:1/2          0          6s
kubia-init   0/2     PodInitializing   0          7s
kubia-init   2/2     Running           0          8s
</code></pre>
<p>As the listing shows, when the init containers run, the pod&#x2019;s status shows the number of init containers that have completed and the total number. When all init containers are done, the pod&#x2019;s status is displayed as <code>PodInitializing</code>. At this point, the images of the main containers are pulled. When the containers start, the status changes to <code>Running</code>.</p>
<h2 id="inspecting-init-containers">Inspecting init containers</h2>
<p>While the init containers run and after they have finished, you can display their logs and enter the running container, just as you can with regular containers.</p>
<h3 id="displaying-the-logs-of-an-init-container">Displaying the logs of an init container</h3>
<p>The standard and error output, into which each init container can write, are captured exactly as they are for regular containers. The logs of an init container can be displayed using the <code>kubectl</code> <code>logs</code> command by specifying the name of the container with the <code>-c</code> option. To display the logs of the <code>network-check</code> container in the <code>kubia-init</code> pod, run the command shown in the following listing.</p>
<pre><code class="lang-shell">Listing 5.12 Displaying the logs of an init container
$ kubectl logs kubia-init -c network-check
Checking network connectivity to 1.1.1.1 ...
Host appears to be reachable
</code></pre>
<p>The logs show that the <code>network-check</code> init container ran without errors. In the next chapter, you&#x2019;ll see what happens if an init container fails.</p>
<h3 id="entering-a-running-init-container">Entering a running init container</h3>
<p>You can use the <code>kubectl exec</code> command to run a shell or a different command inside an init container the same way you can with regular containers, but you can only do this before the init container terminates. If you&#x2019;d like to try this yourself, create a pod from the <code>kubia-init-slow.yaml</code> file, which makes the <code>init-demo</code> container run for 60 seconds. When the pod starts, run a shell in the container with the following command:</p>
<pre><code class="lang-shell">$ kubectl exec -it kubia-init-slow -c init-demo -- sh
</code></pre>
<p>You can use the shell to explore the container from the inside, but not for long. When the container&#x2019;s main process exits after 60 seconds, the shell process is also terminated.</p>
<p>You typically enter a running init container only when it fails to complete in time, and you want to find the cause. During normal operation, the init container terminates before you can run the <code>kubectl exec</code> command.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Running_multiple_containers_in_a_pod.html" class="navigation navigation-prev " aria-label="Previous page: 5.4 Running multiple containers in a pod">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Deleting_pods_and_other_objects.html" class="navigation navigation-next " aria-label="Next page: 5.6 Deleting pods and other objects">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"5.5 Running additional containers at pod startup","level":"4.2.5","depth":2,"next":{"title":"5.6 Deleting pods and other objects","level":"4.2.6","depth":2,"path":"docs/Deleting_pods_and_other_objects.md","ref":"docs/Deleting_pods_and_other_objects.md","articles":[]},"previous":{"title":"5.4 Running multiple containers in a pod","level":"4.2.4","depth":2,"path":"docs/Running_multiple_containers_in_a_pod.md","ref":"docs/Running_multiple_containers_in_a_pod.md","articles":[]},"dir":"ltr"},"config":{"plugins":["page-toc-button","cnzz","hints","sitemap-general"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search":{},"cnzz":{"style":"1","visible":true,"siteid":"1278605528"},"hints":{"danger":"fa fa-bug","info":"fa fa-info-circle","tip":"fa fa-sticky-note","working":"fa fa-cog fa-spin"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sitemap-general":{"prefix":"https://wangwei1237.gitee.io/kubernetes-in-action-second-edition"},"fontsettings":{"theme":"white","family":"serif","size":2},"highlight":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"wangwei17","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":16,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"isbn":"","variables":{},"title":"Kubernetes实战（第二版）","links":{"sharing":{"all":null,"facebook":null,"google":null,"twitter":null,"weibo":null},"sidebar":{"17哥的个人网站":"https://wangwei1237.gitee.io/"}},"gitbook":"*","description":"Kubernetes实战（第二版）","extension":null},"file":{"path":"docs/Running_additional_containers_at_pod_startup.md","mtime":"2023-03-23T08:34:40.358Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-03-23T08:35:06.207Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-cnzz/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

