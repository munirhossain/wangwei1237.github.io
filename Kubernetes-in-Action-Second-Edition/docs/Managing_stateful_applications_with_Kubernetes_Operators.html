
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>15.4 Managing stateful applications with Kubernetes Operators · Kubernetes实战（第二版）</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="wangwei17">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Summary_15.html" />
    
    
    <link rel="prev" href="Updating_a_StatefulSet.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://wangwei1237.gitee.io/" target="_blank" class="custom-link">17哥的个人网站</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    前言
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Welcome</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="Welcome.html">
            
                <a href="Welcome.html">
            
                    
                    Welcome
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Part 1: First Time On a Boat: Introduction to Kubernetes</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="Introducing_Kubernetes_0.html">
            
                <a href="Introducing_Kubernetes_0.html">
            
                    
                    1 Introducing Kubernetes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="Introducing_Kubernetes_1.html">
            
                <a href="Introducing_Kubernetes_1.html">
            
                    
                    1.1 Introducing Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="Understanding_Kubernetes.html">
            
                <a href="Understanding_Kubernetes.html">
            
                    
                    1.2 Understanding Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="Introducing_Kubernetes_into_your_organization.html">
            
                <a href="Introducing_Kubernetes_into_your_organization.html">
            
                    
                    1.3 Introducing Kubernetes into your organization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="Summary_1.html">
            
                <a href="Summary_1.html">
            
                    
                    1.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="Understanding_containers.html">
            
                <a href="Understanding_containers.html">
            
                    
                    2 Understanding containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="Introducing_containers.html">
            
                <a href="Introducing_containers.html">
            
                    
                    2.1 Introducing containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="Exploring_containers_hands-on.html">
            
                <a href="Exploring_containers_hands-on.html">
            
                    
                    2.2 Exploring containers hands-on
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="Understanding_what_makes_containers_possible.html">
            
                <a href="Understanding_what_makes_containers_possible.html">
            
                    
                    2.3 Understanding what makes containers possible
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" data-path="Summary_2.html">
            
                <a href="Summary_2.html">
            
                    
                    2.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="Deploying_your_first_application.html">
            
                <a href="Deploying_your_first_application.html">
            
                    
                    3 DEPLOYING YOUR FIRST APPLICATION
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="Deploying_a_Kubernetes_cluster.html">
            
                <a href="Deploying_a_Kubernetes_cluster.html">
            
                    
                    3.1 Deploying a Kubernetes cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="Interacting_with_Kubernetes.html">
            
                <a href="Interacting_with_Kubernetes.html">
            
                    
                    3.2 Interacting with Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="Running_your_first_application_on_Kubernetes.html">
            
                <a href="Running_your_first_application_on_Kubernetes.html">
            
                    
                    3.3  Running your first application on Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="Summary_3.html">
            
                <a href="Summary_3.html">
            
                    
                    3.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Part 2: Learning the Ropes: Kubernetes API Objects</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="Introducing_the_Kubernetes_API_Objects.html">
            
                <a href="Introducing_the_Kubernetes_API_Objects.html">
            
                    
                    4. Introducing the Kubernetes API Objects
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="Getting_familiar_with_the_Kubernetes_API.html">
            
                <a href="Getting_familiar_with_the_Kubernetes_API.html">
            
                    
                    4.1 Getting familiar with the Kubernetes API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="Examining_an_objects_individual_properties.html">
            
                <a href="Examining_an_objects_individual_properties.html">
            
                    
                    4.2 Examining an object’s individual properties
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="Observing_cluster_events_via_Event_objects.html">
            
                <a href="Observing_cluster_events_via_Event_objects.html">
            
                    
                    4.3 Observing cluster events via Event objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="Summary_4.html">
            
                <a href="Summary_4.html">
            
                    
                    4.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="Running_applications_in_Pods.html">
            
                <a href="Running_applications_in_Pods.html">
            
                    
                    5. Running applications in Pods
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="Understanding_pods.html">
            
                <a href="Understanding_pods.html">
            
                    
                    5.1  Understanding pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="Creating_pods_from_YAML_or_JSON_files.html">
            
                <a href="Creating_pods_from_YAML_or_JSON_files.html">
            
                    
                    5.2 Creating pods from YAML or JSON files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="Interacting_with_the_application_and_the_pod.html">
            
                <a href="Interacting_with_the_application_and_the_pod.html">
            
                    
                    5.3 Interacting with the application and the pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="Running_multiple_containers_in_a_pod.html">
            
                <a href="Running_multiple_containers_in_a_pod.html">
            
                    
                    5.4 Running multiple containers in a pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="Running_additional_containers_at_pod_startup.html">
            
                <a href="Running_additional_containers_at_pod_startup.html">
            
                    
                    5.5 Running additional containers at pod startup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.6" data-path="Deleting_pods_and_other_objects.html">
            
                <a href="Deleting_pods_and_other_objects.html">
            
                    
                    5.6 Deleting pods and other objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.7" data-path="Summary_5.html">
            
                <a href="Summary_5.html">
            
                    
                    5.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="Managing_the_lifecycle_of_the_Pods_containers.html">
            
                <a href="Managing_the_lifecycle_of_the_Pods_containers.html">
            
                    
                    6. Managing the lifecycle of the Pod’s containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="Understanding_the_pods_status.html">
            
                <a href="Understanding_the_pods_status.html">
            
                    
                    6.1 Understanding the pod's status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="Keeping_containers_healthy.html">
            
                <a href="Keeping_containers_healthy.html">
            
                    
                    6.2 Keeping containers healthy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="Executing_actions_at_container_startup_and_shutdown.html">
            
                <a href="Executing_actions_at_container_startup_and_shutdown.html">
            
                    
                    6.3 Executing actions at container start-up and shutdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.4" data-path="Understanding_the_pod_lifecycle.html">
            
                <a href="Understanding_the_pod_lifecycle.html">
            
                    
                    6.4 Understanding the pod lifecycle
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.5" data-path="Summary_6.html">
            
                <a href="Summary_6.html">
            
                    
                    6.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="Mounting_storage_volumes_into_the_Pods_containers.html">
            
                <a href="Mounting_storage_volumes_into_the_Pods_containers.html">
            
                    
                    7. Mounting storage volumes into the Pod’s containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="Introducing_volumes.html">
            
                <a href="Introducing_volumes.html">
            
                    
                    7.1 Introducing volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.2" data-path="Using_volumes.html">
            
                <a href="Using_volumes.html">
            
                    
                    7.2 Using volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="Integrating_external_storage_into_pods.html">
            
                <a href="Integrating_external_storage_into_pods.html">
            
                    
                    7.3 Integrating external storage into pods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.4" data-path="Accessing_files_on_the_worker_nodes_filesystem.html">
            
                <a href="Accessing_files_on_the_worker_nodes_filesystem.html">
            
                    
                    7.4 Accessing files on the worker node’s filesystem
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.5" data-path="Summary_7.html">
            
                <a href="Summary_7.html">
            
                    
                    7.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="Persisting_application_data_with_PersistentVolumes.html">
            
                <a href="Persisting_application_data_with_PersistentVolumes.html">
            
                    
                    8. Persisting application data with PersistentVolumes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="Decoupling_pods_from_the_underlying_storage_technology.html">
            
                <a href="Decoupling_pods_from_the_underlying_storage_technology.html">
            
                    
                    8.1 Decoupling pods from the underlying storage technology
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.2" data-path="Creating_persistent_volumes_and_claims.html">
            
                <a href="Creating_persistent_volumes_and_claims.html">
            
                    
                    8.2 Creating persistent volumes and claims
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.3" data-path="Dynamic_provisioning_of_persistent_volumes.html">
            
                <a href="Dynamic_provisioning_of_persistent_volumes.html">
            
                    
                    8.3 Dynamic provisioning of persistent volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.4" data-path="Nodelocal_persistent_volumes.html">
            
                <a href="Nodelocal_persistent_volumes.html">
            
                    
                    8.4 Node-local persistent volumes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.5" data-path="Summary_8.html">
            
                <a href="Summary_8.html">
            
                    
                    8.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="Configuring_applications_using_ConfigMaps_Secrets_and_the_Downward_API.html">
            
                <a href="Configuring_applications_using_ConfigMaps_Secrets_and_the_Downward_API.html">
            
                    
                    9. Configuring applications using ConfigMaps, Secrets, and the Downward API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="Setting_the_command_arguments_and_environment_variables.html">
            
                <a href="Setting_the_command_arguments_and_environment_variables.html">
            
                    
                    9.1 Setting the command, arguments, and environment variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.2" data-path="Using_a_config_map_to_decouple_configuration_from_the_pod.html">
            
                <a href="Using_a_config_map_to_decouple_configuration_from_the_pod.html">
            
                    
                    9.2 Using a config map to decouple configuration from the pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.3" data-path="Using_Secrets_to_pass_sensitive_data_to_containers.html">
            
                <a href="Using_Secrets_to_pass_sensitive_data_to_containers.html">
            
                    
                    9.3 Using Secrets to pass sensitive data to containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.4" data-path="Passing_pod_metadata_to_the_application_via_the_Downward_API.html">
            
                <a href="Passing_pod_metadata_to_the_application_via_the_Downward_API.html">
            
                    
                    9.4 Passing pod metadata to the application via the Downward API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.5" data-path="Using_projected_volumes_to_combine_volumes_into_one.html">
            
                <a href="Using_projected_volumes_to_combine_volumes_into_one.html">
            
                    
                    9.5 Using projected volumes to combine volumes into one
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.6" data-path="Summary_9.html">
            
                <a href="Summary_9.html">
            
                    
                    9.6 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="Organizing_objects_using_Namespaces_labels.html">
            
                <a href="Organizing_objects_using_Namespaces_labels.html">
            
                    
                    10. Organizing objects using Namespaces, labels, and selectors
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.1" data-path="Organizing_objects_into_Namespaces.html">
            
                <a href="Organizing_objects_into_Namespaces.html">
            
                    
                    10.1 Organizing objects into Namespaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.2" data-path="Organizing_pods_with_labels.html">
            
                <a href="Organizing_pods_with_labels.html">
            
                    
                    10.2 Organizing pods with labels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.3" data-path="Filtering_Objects_With_Label_Selectors.html">
            
                <a href="Filtering_Objects_With_Label_Selectors.html">
            
                    
                    10.3 Filtering objects with label selectors.md
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.4" data-path="Annotating_objects.html">
            
                <a href="Annotating_objects.html">
            
                    
                    10.4 Annotating objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7.5" data-path="Summary_10.html">
            
                <a href="Summary_10.html">
            
                    
                    10.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="Exposing_Pods_with_Services.html">
            
                <a href="Exposing_Pods_with_Services.html">
            
                    
                    11. Exposing Pods with Services
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.8.1" data-path="Exposing_pods_via_services.html">
            
                <a href="Exposing_pods_via_services.html">
            
                    
                    11.1 Exposing pods via services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.2" data-path="Exposing_services_externally.html">
            
                <a href="Exposing_services_externally.html">
            
                    
                    11.2 Exposing services externally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.3" data-path="Managing_service_endpoints.html">
            
                <a href="Managing_service_endpoints.html">
            
                    
                    11.3 Managing service endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.4" data-path="Understanding_DNS_records_for_Service_objects.html">
            
                <a href="Understanding_DNS_records_for_Service_objects.html">
            
                    
                    11.4 Understanding DNS records for Service objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.5" data-path="Configuring_services_to_route_traffic_to_nearby_endpoints.html">
            
                <a href="Configuring_services_to_route_traffic_to_nearby_endpoints.html">
            
                    
                    11.5 Configuring services to route traffic to nearby endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.6" data-path="Managing_the_inclusion_of_a_pod_in_service_endpoints.html">
            
                <a href="Managing_the_inclusion_of_a_pod_in_service_endpoints.html">
            
                    
                    11.6 Managing the inclusion of a pod in service endpoints
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8.7" data-path="Summary_11.html">
            
                <a href="Summary_11.html">
            
                    
                    11.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="Exposing_Services_with_Ingress.html">
            
                <a href="Exposing_Services_with_Ingress.html">
            
                    
                    12. Exposing Services with Ingress
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.9.1" data-path="Introducing_Ingresses.html">
            
                <a href="Introducing_Ingresses.html">
            
                    
                    12.1 Introducing Ingresses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.2" data-path="Creating_and_using_Ingress_objects.html">
            
                <a href="Creating_and_using_Ingress_objects.html">
            
                    
                    12.2 Creating and using Ingress objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.3" data-path="Configuring_TLS_for_an_Ingress.html">
            
                <a href="Configuring_TLS_for_an_Ingress.html">
            
                    
                    12.3 Configuring TLS for an Ingress
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.4" data-path="Additional_Ingress_configuration_options.html">
            
                <a href="Additional_Ingress_configuration_options.html">
            
                    
                    12.4 Additional Ingress configuration options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.5" data-path="Using_multiple_ingress_controllers.html">
            
                <a href="Using_multiple_ingress_controllers.html">
            
                    
                    12.5 Using multiple ingress controllers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.6" data-path="Using_custom_resources_instead_of_services_as_backends.html">
            
                <a href="Using_custom_resources_instead_of_services_as_backends.html">
            
                    
                    12.6 Using custom resources instead of services as backends
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9.7" data-path="Summary_12.html">
            
                <a href="Summary_12.html">
            
                    
                    12.7 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="Replicating_Pods_with_ReplicaSets.html">
            
                <a href="Replicating_Pods_with_ReplicaSets.html">
            
                    
                    13 Replicating Pods with ReplicaSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.10.1" data-path="Introducing_ReplicaSets.html">
            
                <a href="Introducing_ReplicaSets.html">
            
                    
                    13.1 Introducing ReplicaSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.2" data-path="Updating_a_ReplicaSet.html">
            
                <a href="Updating_a_ReplicaSet.html">
            
                    
                    13.2 Updating a ReplicaSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.3" data-path="Understanding_the_operation_of_the_ReplicaSet_controller.html">
            
                <a href="Understanding_the_operation_of_the_ReplicaSet_controller.html">
            
                    
                    13.3 Understanding the operation of the ReplicaSet controller
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.4" data-path="Deleting_a_ReplicaSet.html">
            
                <a href="Deleting_a_ReplicaSet.html">
            
                    
                    13.4 Deleting a ReplicaSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.5" data-path="Summary_13.html">
            
                <a href="Summary_13.html">
            
                    
                    13.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="Managing_Pods_with_Deployments.html">
            
                <a href="Managing_Pods_with_Deployments.html">
            
                    
                    14 Managing Pods with Deployments
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.11.1" data-path="Introducing_Deployments.html">
            
                <a href="Introducing_Deployments.html">
            
                    
                    14.1 Introducing Deployments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.2" data-path="Updating_a_Deployment.html">
            
                <a href="Updating_a_Deployment.html">
            
                    
                    14.2 Updating a Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.3" data-path="Implementing_other_deployment_strategies.html">
            
                <a href="Implementing_other_deployment_strategies.html">
            
                    
                    14.3 Implementing other deployment strategies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.11.4" data-path="Summary_14.html">
            
                <a href="Summary_14.html">
            
                    
                    14.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="Deploying_stateful_workloads_with_StatefulSets.html">
            
                <a href="Deploying_stateful_workloads_with_StatefulSets.html">
            
                    
                    15 Deploying stateful workloads with StatefulSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.12.1" data-path="Introducing_StatefulSets.html">
            
                <a href="Introducing_StatefulSets.html">
            
                    
                    15.1 IntroducingStatefulSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.2" data-path="Understanding_StatefulSet_behavior.html">
            
                <a href="Understanding_StatefulSet_behavior.html">
            
                    
                    15.2 Understanding StatefulSet behavior
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.3" data-path="Updating_a_StatefulSet.html">
            
                <a href="Updating_a_StatefulSet.html">
            
                    
                    15.3 Updating a StatefulSet
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.12.4" data-path="Managing_stateful_applications_with_Kubernetes_Operators.html">
            
                <a href="Managing_stateful_applications_with_Kubernetes_Operators.html">
            
                    
                    15.4 Managing stateful applications with Kubernetes Operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.12.5" data-path="Summary_15.html">
            
                <a href="Summary_15.html">
            
                    
                    15.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.13" data-path="Deploying_node_agents_and_daemons_with_DaemonSets.html">
            
                <a href="Deploying_node_agents_and_daemons_with_DaemonSets.html">
            
                    
                    16 Deploying node agents and daemons with DaemonSets
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.13.1" data-path="Introducing_DaemonSets.html">
            
                <a href="Introducing_DaemonSets.html">
            
                    
                    16.1 Introducing DaemonSets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.2" data-path="Special_features_in_Pods_running_node_agents_and_daemons.html">
            
                <a href="Special_features_in_Pods_running_node_agents_and_daemons.html">
            
                    
                    16.2 Special features in Pods running node agents and daemons
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.3" data-path="Communicating_with_the_local_daemon_Pod.html">
            
                <a href="Communicating_with_the_local_daemon_Pod.html">
            
                    
                    16.3  Communicating with the local daemon Pod
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.13.4" data-path="Summary_16.html">
            
                <a href="Summary_16.html">
            
                    
                    16.4 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >15.4 Managing stateful applications with Kubernetes Operators</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="154-managing-stateful-applications-with-kubernetes-operators">15.4 Managing stateful applications with Kubernetes Operators</h2>
<p>In this chapter, you saw that managing a stateful application can involve more than what Kubernetes provides with the StatefulSet object. In the case of MongoDB, you need to reconfigure the MongoDB replica set every time you scale the StatefulSet. If you don&#x2019;t, the replica set may lose quorum and stop working. Also, if a cluster node fails, manual intervention is required to move the Pods to the remaining nodes.</p>
<p>Managing stateful applications is difficult. StatefulSets do a good job of automating some basic tasks, but much of the work still has to be done manually. If you want to deploy a fully automated stateful application, you need more than what StatefulSets can provide. This is where Kubernetes operators come into play. I&#x2019;m not referring to the people running Kubernetes clusters, but the software that does it for them.</p>
<p>A Kubernetes operator is an application-specific controller that automates the deployment and management of an application running on Kubernetes. An operator is typically developed by the same organization that builds the application, as they know best how to manage it. Kubernetes doesn&#x2019;t ship with operators. Instead, you must install them separately.</p>
<p>Each operator extends the Kubernetes API with its own set of custom object types that you use to deploy and configure the application. You create an instance of this custom object type using the Kubernetes API and leave it to the operator to create the Deployments or StatefulSets that create the Pods in which the application runs, as shown in the following figure.</p>
<p><img src="../images/15.10.png" alt=""></p>
<p>In this section, you&#x2019;ll learn how to use the MongoDB Community Operator to deploy MongoDB. Since I don&#x2019;t know how the operator will change after the book is published, I won&#x2019;t go into too much detail, but I&#x2019;ll list all the steps that were necessary to install the Operator and deploy MongoDB at the time I wrote the book so you can get a feel for what&#x2019;s required even if you don&#x2019;t try it yourself.</p>
<p>If you do want to try this yourself, please follow the documentation in the GitHub repository of the MongoDB community operator at <a href="https://github.com/mongodb/mongodb-kubernetes-operator" target="_blank">https://github.com/mongodb/mongodb-kubernetes-operator</a>.</p>
<h3 id="1541-deploying-the-mongodb-community-operator">15.4.1 Deploying the MongoDB community operator</h3>
<p>An operator is itself an application that you typically deploy in the same Kubernetes cluster as the application that the operator is to manage. At the time of writing, the MongoDB operator documentation instructs you to first clone the GitHub repository as follows:</p>
<pre><code class="lang-shell">$ git clone https://github.com/mongodb/mongodb-kubernetes-operator.git
</code></pre>
<p>Then you go to the <code>mongodb-kubernetes-operator</code> directory, where you find the source code of the operator and some Kubernetes object manifests. You can ignore the source code. You&#x2019;re only interested in the manifest files.</p>
<p>You can decide if you want to deploy the operator and MongoDB in the same namespace, or if you want to deploy the operator so that each user in the cluster can deploy their own MongoDB instance(s). For simplicity, I&#x2019;ll use a single namespace.</p>
<h4 id="extending-the-api-with-the-mongodbcommunity-object-kind">Extending the API with the MongoDBCommunity object kind</h4>
<p>First, you create a CustomResourceDefinition object that extends your cluster&#x2019;s Kubernetes API with an additional object type. To do this, you apply the object manifest as follows:</p>
<pre><code class="lang-shell">$ kubectl apply -f config/crd/bases/mongodbcommunity.mongodb.com_mongodbcommunity.yaml
customresourcedefinition/mongodbcommunity.mongodbcommunity.mongodb.com created
</code></pre>
<p>Using your cluster&#x2019;s API, you can now create objects of kind MongoDBCommunity. You&#x2019;ll create this object later.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>Unfortunately, the object kind is MongoDBCommunity, which makes it hard to understand that this object represents a MongoDB deployment and not a community. The reason it&#x2019;s called MongoDBCommunity is because you&#x2019;re using the community version of the operator. If you use the Enterprise version, the naming is more appropriate. There the object kind is MongoDB, which clearly indicates that the object represents a MongoDB deployment.</p>
</div></div></p>
<h4 id="creating-supporting-objects">Creating supporting objects</h4>
<p>Next, you create various other security-related objects by applying their manifests. Here you need to specify the namespace in which these objects should be created. Let&#x2019;s use the namespace <code>mongodb</code>. Apply the manifests as follows:</p>
<pre><code class="lang-shell">$ kubectl apply -k config/rbac/ -n mongodb
serviceaccount/mongodb-database created
serviceaccount/mongodb-kubernetes-operator created
role.rbac.authorization.k8s.io/mongodb-database created
role.rbac.authorization.k8s.io/mongodb-kubernetes-operator created
rolebinding.rbac.authorization.k8s.io/mongodb-database created
rolebinding.rbac.authorization.k8s.io/mongodb-kubernetes-operator created
</code></pre>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>You&#x2019;ll learn more about these object types and CustomResourceDefinitions in the remaining chapters of this book.</p>
</div></div></p>
<h4 id="installing-the-operator">Installing the operator</h4>
<p>The last step is to install the operator by creating a Deployment as follows:</p>
<pre><code class="lang-shell">$ kubectl create -f config/manager/manager.yaml -n mongodb
deployment.apps/mongodb-kubernetes-operator created
</code></pre>
<p>Verify that the operator Pod exists and is running by listing the Pods in the <code>mongodb</code> namespace:</p>
<pre><code class="lang-shell">$ kubectl get pods -n mongodb
NAME                                           READY   STATUS    RESTARTS   AGE
mongodb-kubernetes-operator-648bf8cc59-wzvhx   1/1     Running   0          9s
</code></pre>
<p>That wasn&#x2019;t so hard, was it? The operator is running now, but you haven&#x2019;t deployed MongoDB yet. The operator is just the tool you use to do that.</p>
<h3 id="1542-deploying-mongodb-via-the-operator">15.4.2 Deploying MongoDB via the operator</h3>
<p>To deploy a MongoDB replica set, you create an instance of the MongoDBCommunity object type instead of creating StatefulSets and the other objects.</p>
<h4 id="creating-an-instance-of-the-mongodbcommunity-object-type">Creating an instance of the MongoDBCommunity object type</h4>
<p>First edit the file <code>config/samples/mongodb.com_v1_mongodbcommunity_cr.yaml</code> to replace the string <code>&lt;your-password-here&gt;</code> with the password of your choice.</p>
<p>The file contains manifests for a MongoDBCommunity and a Secret object. The following listing shows the manifest of the former.</p>
<pre><code class="lang-shell">Listing 15.9 The MongoDBCommunity custom object manifest
apiVersion: mongodbcommunity.mongodb.com/v1
kind: MongoDBCommunity
metadata:
  name: example-mongodb
spec:
  members: 3
  type: ReplicaSet
  version: &quot;4.2.6&quot;
  security:
    authentication:
      modes: [&quot;SCRAM&quot;]
  users:
    - name: my-user
      db: admin
      passwordSecretRef:
        name: my-user-password
      roles:
        - name: clusterAdmin
          db: admin
        - name: userAdminAnyDatabase
          db: admin
      scramCredentialsSecretName: my-scram
  additionalMongodConfig:
    storage.wiredTiger.engineConfig.journalCompressor: zlib
</code></pre>
<p>As you can see, this custom object has the same structure as the Kubernetes API core objects. The <code>apiVersion</code> and <code>kind</code> fields specify the object type, the <code>name</code> field in the <code>metadata</code> section specifies the object name, and the <code>spe</code>c section specifies the configuration for the MongoDB deployment, including <code>type</code> and <code>version</code>, the desired number of replica set members, and the security-related configuration.</p>
<p><div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p>NOTE</p>
<p>If the custom resource definition is well done, as in this case, you can use the kubectl explain command to learn more about the fields supported in this object type.</p>
</div></div></p>
<p>To deploy MongoDB, you apply this manifest file with kubectl apply as follows:</p>
<pre><code class="lang-shell">$ kubectl apply -f config/samples/mongodb.com_v1_mongodbcommunity_cr.yaml
mongodbcommunity.mongodbcommunity.mongodb.com/example-mongodb created
secret/my-user-password created
</code></pre>
<h4 id="inspecting-the-mongodbcommunity-object">Inspecting the MongoDBCommunity object</h4>
<p>You can then see the object you created with the <code>kubectl get</code> command as follows:</p>
<pre><code class="lang-shell">$ kubectl get mongodbcommunity
NAME              PHASE     VERSION
example-mongodb   Running   4.2.6
</code></pre>
<p>Just like the other Kubernetes controllers, the object you created is now processed in the reconciliation loop running in the operator. Based on the MongoDBCommunity object, the operator creates several objects: a StatefulSet, two Services, and some Secrets. If you check the <code>ownerReferences</code> field in these objects, you&#x2019;ll see that they&#x2019;re all owned by the <code>example-mongodb</code> MongoDBCommunity object. If you make direct changes to these objects, such as scaling the StatefulSet, the operator will immediately undo your changes.</p>
<p>After the operator creates the Kubernetes core objects, the core controllers do their part. For example, the StatefulSet controller creates the Pods. Use <code>kubectl get</code> to list them as follows:</p>
<pre><code class="lang-shell">$ kubectl get pods -l app=example-mongodb-svc
NAME                READY   STATUS    RESTARTS   AGE
example-mongodb-0   2/2     Running   0          3m
example-mongodb-1   2/2     Running   0          2m
example-mongodb-2   2/2     Running   0          1m
</code></pre>
<p>The MongoDB operator not only creates the StatefulSet, but also makes sure that the MongoDB replica set is initiated automatically. You can use it right away. No additional manual configuration is required.</p>
<h4 id="managing-the-mongodb-deployment">Managing the MongoDB deployment</h4>
<p>You control the MongoDB deployment through the MongoDBCommunity object. The operator updates the configuration every time you update this object. For example, if you want to resize the MongoDB replica set, you change the value of the <code>members</code> field in the <code>example-mongodb</code> object. The operator then scales the underlying StatefulSet and reconfigures the MongoDB replica set. This makes scaling MongoDB trivial.</p>
<p>NOTE</p>
<p>At the time of writing, you can&#x2019;t use the kubectl scale command to scale the MongoDBCommunity object, but I&#x2019;m sure the MongoDB operator developers will fix this soon.</p>
<h3 id="1543-cleaning-up">15.4.3 Cleaning up</h3>
<p>To uninstall MongoDB, delete the MongoDBCommunity object as follows:</p>
<pre><code class="lang-shell">$ kubectl delete mongodbcommunity example-mongodb
mongodbcommunity.mongodbcommunity.mongodb.com &quot;example-mongodb&quot; deleted
</code></pre>
<p>As you might expect, this orphans the underlying StatefulSet, Services, and other objects. The garbage collector then deletes them. To remove the operator, you can delete the entire <code>mongodb</code> Namespace as follows:</p>
<pre><code class="lang-shell">$ kubectl delete ns mongodb
namespace &quot;mongodb&quot; deleted
</code></pre>
<p>As a last step, you also need to delete the CustomResourceDefinition to remove the custom object type from the API as follows:</p>
<pre><code class="lang-shell">$ kubectl delete crd mongodbcommunity.mongodbcommunity.mongodb.com
customresourcedefinition &quot;mongodbcommunity.mongodbcommunity.mongodb.com&quot; deleted
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Updating_a_StatefulSet.html" class="navigation navigation-prev " aria-label="Previous page: 15.3 Updating a StatefulSet">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Summary_15.html" class="navigation navigation-next " aria-label="Next page: 15.5 Summary">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"15.4 Managing stateful applications with Kubernetes Operators","level":"4.12.4","depth":2,"next":{"title":"15.5 Summary","level":"4.12.5","depth":2,"path":"docs/Summary_15.md","ref":"docs/Summary_15.md","articles":[]},"previous":{"title":"15.3 Updating a StatefulSet","level":"4.12.3","depth":2,"path":"docs/Updating_a_StatefulSet.md","ref":"docs/Updating_a_StatefulSet.md","articles":[]},"dir":"ltr"},"config":{"plugins":["page-toc-button","cnzz","hints","sitemap-general"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search":{},"cnzz":{"style":"1","visible":true,"siteid":"1278605528"},"hints":{"danger":"fa fa-bug","info":"fa fa-info-circle","tip":"fa fa-sticky-note","working":"fa fa-cog fa-spin"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sitemap-general":{"prefix":"https://wangwei1237.gitee.io/kubernetes-in-action-second-edition"},"fontsettings":{"theme":"white","family":"serif","size":2},"highlight":{},"page-toc-button":{"maxTocDepth":2,"minTocSize":2},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"wangwei17","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":16,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"isbn":"","variables":{},"title":"Kubernetes实战（第二版）","links":{"sharing":{"all":null,"facebook":null,"google":null,"twitter":null,"weibo":null},"sidebar":{"17哥的个人网站":"https://wangwei1237.gitee.io/"}},"gitbook":"*","description":"Kubernetes实战（第二版）","extension":null},"file":{"path":"docs/Managing_stateful_applications_with_Kubernetes_Operators.md","mtime":"2023-02-10T05:19:18.243Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2023-02-10T05:19:44.017Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-cnzz/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

